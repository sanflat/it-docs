# SQL

## SQLとは
SQLとは、1970年代に開発されたデータベース言語のことです。
SQLは、あくまでデータベースを操作する言語なので、プログラミング言語ではありません。
データベースを使っているWebサービスはほとんどないと言っても過言ではなく、WEBアプリケーション開発などでは必要なスキルになります。

## SQLの特徴
SQLで出来ることは大きくわけると3つあります。

1. データ操作
2. データ定義
3. データ制御

1つずつ説明します。

データを操作する言語(データ操作言語)のことを、DML(Data Manipulation Language)といいます。
データベースにデータを登録したり、特定の条件にあったものを抽出したり、一度登録したデータを更新・削除したりといった操作を行えます。
具体的には、以下の4つの構文のことです。


DMLの構文

| 命令文 | 内容 |
| :-- | :-- |
| SELECT | データを検索する |
| INSERT | データを挿入する |
| UPDATE | データを更新する |
| DELETE | データを削除する |


データを定義する言語(データ定義言語)のことを、DDL(Data Definition Language)といいます。
データベースに含まれる中身(テーブルやインデックスなどの構造、オブジェクト同士の関係等)を定義し、データの整合性を保つことができます。
具体的には、以下の5つの構文のことです。


DDLの構文

| 命令文 | 内容 |
| :-- | :-- |
| CREATE | 新しいデータベースやテーブルなどのオブジェクトを定義 |
| JOIN | テーブル同士を結合する |
| DROP | 定義したオブジェクトを削除する |
| ALTER | 定義したオブジェクトの内容を変更する |
| TRUNCATE | すべてのデータを削除する |


データを制御する言語(データ制御言語)のことを、DCL(Data Control Language)といいます。
ユーザー権限やトランザクションなど、データへのアクセスを制御することができ、権限を与えたり、権限を剥奪したりすることができます。
具体的には、以下の5つの構文のことです。


DCLの構文

| 命令文 | 内容 |
| :-- | :-- |
| GRANT | ユーザー権限を付与する |
| REVOKE | ユーザー権限を削除する |
| BEGIN | トランザクションを開始する |
| COMMIT | トランザクションを確定する |
| ROLLBACK | トランザクションを巻き戻す |

## リレーショナルデータベースマネジメントシステム(RDBMS)

データベースを管理するシステムには色々種類があります。
有名どころは、Oracle Database、MySQL、Postgresqlなどです。
これらのデータベースを管理するシステムのことを、リレーショナルデータベースマネジメントシステムと言います。
省略してRDBMSともいいます。

リレーショナルデータベースマネジメントシステムとは、言葉の通りリレーショナルデータベースを管理するためのソフトウェアを指します。


## リレーショナルデータベース(RDB)

リレーショナルデータベース(Relationak Database)は、データベースの一種です。
省略してRDBとも呼ばれます。

データベースとは収集したデータを、検索や追加などが簡単にできるように整理したものです。
データベースには、リレーショナルデータベースの他に、階層型データべース、ネットワーク型データベースなどがありますが、リレーショナルデータベースは一番スタンダードなタイプのデータベースです。

リレーショナルデータベースの特徴は、データを「表形式」で管理することです。
関係の深い属性を列で並ばせ、そこに行としてデータを登録していくイメージです。
列や行を指定したり、表と表をつなぎ合わせたりしながらデータの検索ができます。
このリレーショナルデータベースを管理するためのRDBMSは、SQLを使って、データの登録・検索・更新・削除をすることができます。


## テーブル(Table)

RDBMSは複数のテーブルで構成されています。
テーブルとは「ある一定のまとまりのある、表形式のデータ群」です。

イメージするために、Excelに例えてみます。
データベースそのものは、Excelのファイル。
テーブルは、Excelの1つ1つのワークシートのことです。

ワークシートには、それぞれ列と行があると思います。
テーブルでは、列のデータのことを「カラム」、行のデータのことを「レコード」といいます。


## SELECT

SELECT文を発行することで、データベースから欲しい情報を取り出すことがでいます。


```jsx highlight=4,6-8
SELECT カラム名 
FROM テーブル名;
```

## WHERE

特定の条件でデータベースから欲しい情報を取り出すには、WHEREを使います。

WHEREは、SELECT文にWHEREをつけることで、テーブルの中の特定の行を取得できます。
カラム指定はSELECTでレコード指定はWHEREのようにイメージしておくと良いでしょう。

WHEREを追加した構文は以下のようになります。
FROMに後に着け、条件式にはイコールや大なり、小なり、否定などを使った式が入ります。


```jsx highlight=4,6-8
SELECT カラム名 
FROM テーブル名
WHERE 条件式;
```

## ORDER BY

抽出対象のデータを並び替えるには、ORDER BYを使います。

ORDER BYは、SELECT文にORDER BYをつけることで、取得するデータを昇順、降順に並び変えることができます。

ORDER BYを追加した構文は以下のようになります。
FROMに後に着け、並び変え条件には、カラム名やカラムの番号 & ASC(昇順) or DESC(降順)が入ります。

```jsx highlight=4,6-8
SELECT カラム名 
FROM テーブル名
ORDER BY 並び替え条件;
```

複数のカラムを並び替え条件に指定することも可能です。
複数指定は、並び替え条件をカンマで区切ることで指定できます。

その場合、優先的に並び変えされるのは先に指定したカラムになります。
なお、前項で紹介したWHEREと組み合わせて使用する場合、ORDER BYはWHEREの後に記述します。
最後に書くと覚えておくと良いでしょう。


```jsx highlight=4,6-8
SELECT カラム名 
FROM テーブル名
WHERE 条件式
ORDER BY 並び替え条件1, 並び変え条件2, 並び変え条件3;
```

## GROUP BY

データをルールに従ってグルーピングするのに、GROUP BYが使えます。

GROUP BYと記述したのち、グルーピングしたいカラムを指定します。
前項で紹介したORDER BYとWHEREの間に書きます。

```jsx highlight=4,6-8
SELECT カラム名 
FROM テーブル名
WHERE 条件式
GROUP BY カラム名
ORDER BY 並び替え条件1, 並び変え条件2, 並び変え条件3;
```

## 集計関数(sum,count,avg,min,max)

集計関数とは、合計、カウント、平均、最小値、最大値などを求めることができる関数です。
集約関数といったりもします。
集計関数は、SELECTで以下のような構文で書きます。

```jsx highlight=4,6-8
SELECT 
　sum(カラム名) ,
　count(カラム名) ,
　avg(カラム名) ,
　min(カラム名) ,
　max(カラム名) 
FROM テーブル名;
```

ほぼ名前の通りですが、sumは合計。countはレコードの行数。avgは平均。maxやminは最大値、最小値を算出できます。

## HAVING

HAVINGは、グルーピングされたデータの中から、さらに特定の条件でデータを抽出したい時に使います。
前項で特定の条件で抽出したい時に使うものとしてWHEREを記載していますが、
WHEREは「単純にテーブル内のデータを抽出する」のに対し、
HAVINGは「グルーピングされたデータの中からさらに特定の条件でデータを抽出する」という点が異なります。

HAVINGはGROUP BYとORDER BYの間に記述します。
またHAVINGは集計関数で条件式を記述する必要があります。
以下のような構文です。

```jsx highlight=4,6-8
SELECT グルーピングするカラム名,集計関数
FROM テーブル名
WHERE 条件式
GROUP BY グルーピングするカラム名
HAVING 集計関数で条件式(例：sum(price) >= 10000)
ORDER BY ソート条件3;
```

## SQLの呼ばれる順番

実はデータベースがSQLの各コマンドを解釈するのは、単純に上から下へ1行ずつ見ていくのではなく、
ちゃんと順番があります。
前項で紹介した各コマンドの実行順序は以下の通りです。

```markdown
SQLコマンド実行
1. FROM
2. WHERE
3. GROUP BY
4. HAVING
5. SELECT
6. ORDER BY
結果表示
```

他にもSQLのコマンドは存在しますが、基本的には前述で紹介したコマンドを使うはずです。
その場合、SQLを考える際は、以下のように考えると良いでしょう。
```markdown
1. どのテーブルの(FROM)
2. どのデータを(WHERE)
3. どうグルーピングし(GROUP BY)
4. グルーピングしたデータをどう抽出し(HAVING)
5. どのカラムを(SELECT)
6. どの順番で表示するか(ORDER BY)
結果表示
```

## INNER JOIN

INNER JOINは、テーブルとテーブルを結合するためのものです。
内部結合といったりもします。

INNER JOINは、FROMとWHEREの間に記述します。

```jsx highlight=4,6-8
SELECT *
FROM テーブル名A as a
INNER JOIN テーブル名B as b ON a.id = b.id;
```

asとは、あだ名のようなものです、テーブル名が長かったりすると、
INNER JOINで結合することで可読性が悪くなってしまうのでasを用いることが多いです。

onについてですが、これは「どのカラムを結合するか」を指定しています。
これにより、テーブルAのidとテーブルBのidにより結合したデータからレコードを抽出できるようになります。

## LEFT JOIN

LEFT JOINもINNER JOINと同じようにテーブルとテーブルを結合するためのものです。
外部結合といったりします。

LEFT JOINも、FROMとWHEREの間に記述し、INNER JOINと同じ構文になります。
異なる点はonで指定し結合できなかったレコードも実行結果に表示されることです。
以下のようなテーブルがあったとして、それぞれの実行結果をみてみます。

テーブル名A

| id | name |
| :-- | :-- |
| 1 | Ａ |
| 2 | Ｂ |
| 3 | Ｃ |
| 4 | Ｄ |

テーブル名B

| id | name |
| :-- | :-- |
| 1 | a |
| 2 | b |
| 3 | c |

SQL
```jsx highlight=4,6-8
SELECT *
FROM テーブル名A as a
INNER JOIN テーブル名B as b ON a.id = b.id;

SELECT *
FROM テーブル名A as a
LEFT JOIN テーブル名B as b ON a.id = b.id;
```

※INNER JOINの場合

| id | name | id | name |
| :-- | :-- | :-- | :-- |
| 1 | A | 1 | a |
| 2 | B | 2 | b |
| 3 | C | 3 | c |

※LEFT JOINの場合
| id | name | id | name |
| :-- | :-- | :-- | :-- |
| 1 | A | 1 | a |
| 2 | B | 2 | b |
| 3 | C | 3 | c |
| 4 | D | null | null |

このように、INNER JOINではテーブルBには、idが4のレコードは存在しない(紐づかない)ので、抽出されませんが。
LEFT JOINではnullとして表示されました。

## UNION
## UNION ALL

# SurrealDB
